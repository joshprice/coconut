<html>
<head>
  <title>Build Part with Behaviour Spec</title>
  <script src="../lib/jquery-1.3.2.js"></script>
  <script src="screw.unit.dependencies.js"></script>
  <script src="test_extensions.js"></script>
  <script src="../src/jquery.coconut.js"></script>
</head>
<body>

<div id="fixture">
  <div id="person">
    <input type="text" value="luning" name="name"></input>
    <select name="title">
      <option selected="selected">please select</option>
      <option>Mr</option>
      <option>Mrs</option>
    </select>
    <div>
      <input type="radio" value="Male" checked="checked" name="gender">Male</input>
      <input type="radio" value="Female" name="gender">Female</input>
    </div>
    <div part="" name="dob">
      <select name="day">
        <option selected="selected">please select</option>
        <option>01</option>
        <option>02</option>
      </select>
      <select name="month">
        <option selected="selected">please select</option>
        <option>Jan</option>
        <option>Feb</option>
      </select>
      <select name="year">
        <option selected="selected">please select</option>
        <option>1990</option>
        <option>1991</option>
      </select>
    </div>
    <input id="nationality" type="text" someproperty="nationality"></input>
    <input id="id_city" type="text" sname="city"></input>
    <div class="emails">
      <input type="text" fieldtype="array,.emails" value="luning.tw@gmail.com" name="email"></input>
    </div>
    <div part="" fieldtype="array" name="contact">
      <input type="text" name="number"></input>
      <input type="text" name="type"></input>
    </div>
  </div>
  <input id="randomInput" type="text"></input>
</div>

<script type="text/javascript">
Screw.Unit(function() {

  var fixtureHtml = $("#fixture").html();

  before(function() {
    $("#fixture").html(fixtureHtml);
  });

  describe("Build Part with Behaviour", function() {

    it("should mixin method defined in behaviour", function() {
      function Person(){};
      Person.prototype = {
        getNameAndGender: function(){
          return this.name.state() + "," + this.gender.state();
        }
      };

      var person = $("#person").part(Person);
      person.state({name:"smith", gender:"Female"});

      expect(person.getNameAndGender()).to(equal, "smith,Female");
    });

    it("should capture (initial) state after constructor behaviour is applied", function() {
      function Person(){
        this.name.state("smith");
      };

      var person = $("#person").part(Person);
      person.resetState();

      expect(person.name.state()).to(equal, "smith");
    });

    it("should pick behaviour specified in dom", function() {
      $("#person").attr("part", "Person");

      window.Person = function(){
        this.getSomething = "something";
      };

      var person = $("#person").part();

      expect(person.getSomething).to(equal, "something");
    });

    it("should be able to add behaviour after construction", function() {
      function SayHello(){
        this.helloMessage = "hello";
      };

      var person = $("#person").part().addBehaviour(SayHello);

      expect(person.helloMessage).to(equal, "hello");
    });

    it("should not affect (initial) state for behaviour added after construction", function() {
      function Person(){
        this.name.state("smith");
      };

      var person = $("#person").part()
              .addBehaviour(Person)
              .resetState();

      expect(person.name.state()).to(equal, "luning");
    });
    
    it("should not build with invalid behaviour specified in dom", function() {
      $("#person").attr("part", "InvalidBehaviour");

      try{
        $("#person").part();
        expect(true).to(be_false);
      } catch (ex) {
        expect(ex.toString()).to(match, "CoconutError");
      }
    });

  });

});
</script>
</body>
</html>