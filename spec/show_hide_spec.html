<html>
<head>
	<title>Javascript Tests</title>
	<script src="../lib/jquery-1.3.2.js"></script>
	<script src="screw.unit.dependencies.js"></script>
	<script src="test_extensions.js"></script>
	<script src="../src/coconut.js"></script>
</head>
<body>

<div id="fixture">
	<div id="part1">
		<div id="container">
			<span id="span1"></span>
			<input id="part1_field" type="text"></input>
		</div>
	</div>
	<div id="part2">
		<span id="span"></span>
		<input id="part2_field" type="text" value="DEFAULT"></input>
		<select id="dropdown">
			<option selected="selected">please select</option>
			<option>SOMEVAL</option>
		</select>
		<div>
			<input id="radio1" type="radio" value="YES" name="group">Yes</input>
			<input id="radio2" type="radio" value="NO" name="group" checked="checked">No</input>
		</div>
		<div>
			<input id="radio21" type="radio" value="OPTION1" name="group2">1</input>
			<input id="radio22" type="radio" value="OPTION2" name="group2" checked="checked">2</input>
			<input id="radio23" type="radio" value="OPTION3" name="group2">3</input>
		</div>
		<div>
			<input id="radio3" type="radio" value="YES" name="group3">Yes</input>
			<input id="radio4" type="radio" value="NO" name="group3">No</input>
		</div>
	</div>
	
</div>

<script type="text/javascript">

	function Part1() {
		StateAware.call(this);
		this.setupModelFields({ field: "#part1_field" });
		this.aggregateFieldEvent("change");
		this.setupInitialState();
	}
	$.extend(Part1.prototype, StateAware.prototype, {});

	function Part2() {
		StateAware.call(this);
		this.setupModelFields({
			field:		"#part2_field",
			dropdown:	"#dropdown",
			radios:		":radio[name=group]",
			radios2:	":radio[name=group2]",
			radios3:	":radio[name=group3]"
		});
		
		this.setupDerivedFields({
			span: "#span"
		});
		
		this.aggregateFieldEvent("change");
		this.setupInitialState();
	}
	$.extend(Part2.prototype, StateAware.prototype, {});

	function PartWithDerivedField() {
		StateAware.call(this);
		this.setupModelFields({ field: "#part1_field" });
		this.setupDerivedFields({ span: "#span1" });
		
		this.aggregateFieldEvent("change");
		this.setupInitialState();

		this.copyOfField = this.createDerivedField(this.field, function() {
			return this.field.value(); // normally this would be some transform of the original value
		});
	}
	$.extend(PartWithDerivedField.prototype, StateAware.prototype, {});

	Screw.Unit(function() {

		var fixtureHtml = $("#fixture").html();

		before(function() {
			$("#fixture").html(fixtureHtml);
			$().unbind("Part1.change"); $().unbind("Part2.change"); $().unbind("PartWithDerivedField.change");
		});

		describe("Show / Hide extra fields group", function() {

			it("should show extra fields if condition is satisfied", function() {
				var part1 = new Part1();
				var part2 = new Part2();

				part1.showHideSection("#container", ["field"], part2.radios2, "OPTION2");

				part2.setState({ radios2: "OPTION1" });
				expect(part1.field).to_not(be_visible);

				part2.setState({ radios2: "OPTION2" });
				expect(part1.field).to(be_visible);
			});

			it("should trigger show/hide while setting up show hide section", function() {
				var part1 = new Part1();
				var part2 = new Part2();

				expect(part1.field).to(be_visible);

				part1.showHideSection("#container", ["field"], part2.radios2, "OPTION3");

				expect(part1.field).to_not(be_visible);
			});
		});
	});
</script>
</body>
</html>
