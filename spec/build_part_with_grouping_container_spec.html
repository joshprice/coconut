<html>
<head>
  <title>Build Part with Grouping Container Spec</title>
  <script src="../lib/jquery-1.3.2.js"></script>
  <script src="screw.unit.dependencies.js"></script>
  <script src="test_extensions.js"></script>
  <script src="../src/jquery.coconut.js"></script>
</head>
<body>

<div id="fixture">
  <div id="person">
    <input type="text" value="luning" name="name"></input>
    <div iscontainer="true" name="basicInfo">
      <select name="title">
        <option selected="selected">please select</option>
        <option>Mr</option>
        <option>Mrs</option>
      </select>
      <div>
        <input type="radio" value="Male" checked="checked" name="gender">Male</input>
        <input type="radio" value="Female" name="gender">Female</input>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
Screw.Unit(function() {

  var fixtureHtml = $("#fixture").html();

  before(function() {
    $("#fixture").html(fixtureHtml);
  });

  describe("Build Part with Grouping Container", function() {

    it("should build a jQuery container for dom element if 'iscontainer' property is set to true in dom", function() {
      var person = $("#person").part();

      expect(person.basicInfo.jquery).to_not(be_undefined);
    });
    
    it("should not build container if name conflicts with existing property of part", function() {
      $("div[name=basicInfo]").attr("name", "container");
    
      try{
        var person = $("#person").part();
        expect(true).to(be_false);
      } catch (ex) {
        expect(ex.toString()).to(match, "CoconutError");
      }
    });  
    
    it("should use name specified by 'sname' property in dom", function() {
      $("div[name=basicInfo]").attr("sname", "extInfo");
    
      var person = $("#person").part();
      
      expect(person.basicInfo).to(be_undefined);
      expect(person.extInfo.jquery).to_not(be_undefined);
    });
    
    it("should not build container if can not determine a name for it", function() {
      $("div[name=basicInfo]").removeAttr("name");
    
      try{
        var person = $("#person").part();
        expect(true).to(be_false);
      } catch (ex) {
        expect(ex.toString()).to(match, "CoconutError");
      }
    });

  });
  
  describe("Grouping Container", function() {

    it("should reset fields in it", function() {
      var person = $("#person").part();
      person.state({ name: "smith", title: "Mr", gender: "Female" });
      
      person.basicInfo.resetState();
      
      expect(person.title.state()).to(equal, "please select");
      expect(person.gender.state()).to(equal, "Male");
      
      expect(person.name.state()).to(equal, "smith");
    });
    
  });
  
});
</script>
</body>
</html>